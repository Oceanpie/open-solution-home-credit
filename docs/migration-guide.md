# 迁移指南（Migration Guide）

## 1. 迁移原则

1. 项目命名不变。
2. 旧代码归档到 `src/legacy`。
3. 新开发只在新路径进行，不再使用旧运行策略。
4. 旧代码暂不删除。

## 2. 目录与文件策略

1. `src/legacy/`: 存放原始实现（尽量保持原结构与代码形态）。
2. `src/`: 存放重构后的新实现。
3. `requirements.txt`: 新依赖入口。
4. `requirements-legacy.txt`（必须新增）: 存档旧依赖版本。

## 3. 配置迁移策略

1. 原配置保留存档，不直接作为新实现运行入口。
2. 新实现使用新配置键。
3. 对应关系写入映射表（建议文件：`docs/config-mapping.md`）。
4. 不支持的旧配置项必须在日志中报出明确提示。

## 4. 命令策略

1. 旧命令语义可保留，但内部执行只走新实现。
2. 不提供“旧代码执行开关”。
3. 需要兼容时，通过命令映射文档说明“旧命令 -> 新命令”。

## 5. 追踪策略

1. 默认模式：`offline`。
2. `online` 模式：允许上传到 W&B。
3. 禁止将敏感信息写入日志与 artifact。

## 6. 验收清单（迁移完成判定）

1. 新路径可独立运行核心命令。
2. 产物文件结构满足既有约定。
3. W&B 在 `offline` 与 `online` 两种模式均行为正确。
4. `ruff` 检查通过。
5. 旧代码已归档到 `src/legacy`，且未被新执行路径引用。

## 7. 回退策略

1. 代码级回退：通过 Git 回退到上一个稳定 tag/commit。
2. 依赖级回退：使用 `requirements-legacy.txt` 复现旧环境。
3. 文档级回退：保留本文件历史版本，避免迁移策略丢失。
