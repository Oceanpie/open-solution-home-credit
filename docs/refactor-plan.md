# 重构总计划（Refactor Plan）

## 1. 目标

在不改变项目业务设计思路的前提下，用现代技术栈重构工程实现：

1. Python 版本统一为 `3.12`。
2. 实验追踪使用 W&B（默认 `offline`，可切 `online`）。
3. 旧代码归档到 `src/legacy`，新实现走新代码路径。
4. 使用 `ruff` 做代码质量检查。
5. CI 暂置空，后续单独补齐。

## 2. 范围

包含：

1. 工程结构重组与旧代码归档。
2. 依赖升级与依赖存档。
3. 追踪、流水线、模型实现的现代化替换。
4. 文档与迁移说明完善。

不包含：

1. 以模型分数为目标的重新训练优化。
2. 旧代码删除（本阶段不删）。
3. notebook 立即重写（先存档）。

## 3. 技术栈决策

1. Python: `3.12`
2. 依赖管理: `requirements.txt`（旧依赖单独存档）
3. 追踪: W&B
4. 代码质量: `ruff`
5. 目录策略: `src/legacy` 存档旧实现

## 4. 分阶段里程碑

1. PR-1：追踪层改造（Neptune -> 可插拔 Tracker -> W&B）。
2. PR-2：目录重组与旧代码归档（`src/legacy`）。
3. PR-3：流水线重构（新实现替代旧执行路径）。
4. PR-4：模型层重构（保持现有设计，不做联合优化）。
5. PR-5：文档收口与开发流程稳定化（ruff、迁移文档、常见问题）。

## 5. 验收基线（工程行为基线）

不以“重新训练到同分”为验收条件，采用以下基线：

1. 命令基线：核心命令可执行完成（`train/evaluate/predict/train_evaluate_predict_cv`）。
2. 功能基线：支持 `dev_mode`，流程可跑通。
3. 产物基线：关键输出文件结构与字段符合既有约定（例如 `submission` 列结构）。
4. 配置基线：旧配置可映射到新配置，无法映射项需明确说明。
5. 日志基线：默认 `offline` 可运行；切换 `online` 可上报 W&B。
6. 质量基线：`ruff` 通过。

## 6. 风险与约束

1. 旧代码暂不删除，确保可回溯。
2. 先做实现替换，不做算法层过度设计。
3. notebook 先存档，后续再按新代码重构。
